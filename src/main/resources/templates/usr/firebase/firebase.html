<html layout:decorate="~{layout/layout}" xmlns:layout="http://www.w3.org/1999/xhtml">

<head><title>firebase test</title></head>

<div layout:fragment="content" class="min-h-screen flex flex-col items-center gap-12 bg-base-200">

    <h1>Test page!</h1>
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/5.9.2/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.9.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.9.2/firebase-messaging.js"></script>
    <!-- TODO: Add SDKs for Firebase products that you want to use
         https://firebase.google.com/docs/web/setup#available-libraries -->

    <script th:inline="javascript">

        let firebaseConfig = {
            apiKey: "AIzaSyB7AIDmo5v_7LtOwIySVqHTrei97wDekLA",
            authDomain: "inhub-50c3d.firebaseapp.com",
            projectId: "inhub-50c3d",
            storageBucket: "inhub-50c3d.appspot.com",
            messagingSenderId: "348918158865",
            appId: "1:348918158865:web:3528db683cc719688043b0",
            measurementId: "G-25PSHDGP5Y"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // Show Notification
        // 메시지 기능 활성화를 알림
        const messaging = firebase.messaging();
        // RequestPermission 첫 어플 시작 시 알림 허용 or 불허를 사용자에게 안내합니다.
        // 허용하지 않을 시 알람 메시지는 가지 않습니다.
        messaging.requestPermission()
            .then(function () {
                // 알람이 허용되었을 때 토큰을 반환합니다.
                // 해당 토큰을 통해 FCM 특정 사용자에게 메시지를 보낼 수 있습니다.
                return messaging.getToken();
            })
            .then(async function (token) {
                console.log(token);
                // 해당 onMessage는 데이터메시지로, 포그라운드인 상태에서
                // FCM 메시지를 전송하는 경우 콘솔에 표기하도록 작성된 코드입니다.

                messaging.onMessage(payload => {
                    console.log(payload);

                })
            })

    </script>

</div>
</html>