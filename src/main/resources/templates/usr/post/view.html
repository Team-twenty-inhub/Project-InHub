<html layout:decorate="~{layout/layout}" xmlns:layout="http://www.w3.org/1999/xhtml">
<head>
  <title>게시물 상세 보기</title>
  <style>
    .post-details {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      text-align: left;
    }

    .post-title {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .post-created {
      font-size: 14px;
      color: #888;
      margin-bottom: 20px;
    }

    .post-content {
      text-align: left;
    }

    .btn-container {
      display: flex;
      justify-content: flex-end;
      margin-top: 20px;
    }

    .btn-container .btn {
      margin-left: 10px;
    }

    .comment-form {
      margin-top: 20px;
    }

    .comment-form textarea {
      width: 100%;
      height: 100px;
      margin-bottom: 10px;
    }
  </style>
</head>
<div layout:fragment="content" class="min-h-screen flex flex-col items-center gap-12">
  <div class="post-details">
    <h1 class="post-title" th:text="${post.title}"></h1>
    <p class="post-created" th:text="${#temporals.format(post.createdTime, 'yyyy-MM-dd HH:mm:ss')}"></p>
    <p class="text-gray-500" th:text="${post.member.nickname}"></p>
    <p class="post-content" th:text="${post.content}"></p>
    <div class="btn-container">
      <a th:href="@{/post/edit/{id}(id=${post.id})}" class="btn btn-primary">수정</a>
      <form th:action="@{/post/delete/{postId}(postId=${post.id})}" method="post" id="deleteForm" onsubmit="return confirmDelete()">
        <input type="hidden" name="_method" value="DELETE">
        <input type="hidden" name="_csrf" value="${_csrf.token}">
        <button type="submit" class="btn btn-error" onclick="return confirmDelete()">삭제</button>
      </form>
      <a href="/post/list" class="btn btn-primary">목록으로 돌아가기</a>
    </div>
  </div>

  <div class="comment-list">
    <h2>댓글</h2>
    <ul>
      <li th:each="comment : ${comments}">
        <p th:text="${comment.content}"></p>
        <p th:text="${comment.member.nickname}"></p>

        <!-- 댓글 수정 버튼 -->
        <a href="#" onclick="showEditForm(event, 'commentForm-${comment.id}')">수정</a>

        <!-- 수정된 댓글 표시 -->
        <div id="commentForm-${comment.id}" style="display: none;">
          <form th:action="@{/comment/update/{id}(id=${comment.id})}" method="post">
            <input type="hidden" name="_csrf" value="${_csrf.token}">
            <textarea name="content" placeholder="댓글을 입력하세요" class="textarea textarea-bordered textarea-md w-full max-w-xs" th:text="${comment.content}"></textarea>
            <button type="submit">수정 완료</button>
          </form>
        </div>

        <!-- 댓글 삭제 버튼 -->
        <form th:action="@{/comment/delete/{id}(id=${comment.id})}" method="post" onsubmit="return confirmDelete()">
          <input type="hidden" name="_method" value="DELETE">
          <input type="hidden" name="_csrf" value="${_csrf.token}">
          <button type="submit" class="btn btn-sm btn-error">삭제</button>
        </form>
      </li>
    </ul>
  </div>

  <div class="comment-form">
    <form th:action="@{/comment/create}" method="post">
      <input type="hidden" name="postId" th:value="${post.id}">
      <textarea name="content" placeholder="댓글을 입력하세요" class="textarea textarea-bordered textarea-md w-full max-w-xs"></textarea>
      <button type="submit" class="btn btn-primary">댓글 작성</button>
    </form>
  </div>

  <script>
    function showEditForm(event, formId) {
      event.preventDefault();
      var form = document.getElementById(formId);
      form.style.display = "block";
    }

    function confirmDelete() {
      var confirmation = confirm('정말로 삭제하시겠습니까?');
      return confirmation;
    }
  </script>
</div>
</html>
